# üéÆ Pok√©Arena API

> API RESTful para gerenciamento de pok√©mons e sistema de batalhas probabil√≠stico

[![TypeScript](https://img.shields.io/badge/TypeScript-5.7-blue.svg)](https://www.typescriptlang.org/)
[![NestJS](https://img.shields.io/badge/NestJS-11.x-red.svg)](https://nestjs.com/)
[![Node.js](https://img.shields.io/badge/Node.js-24.x-green.svg)](https://nodejs.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

[![Deploy](https://img.shields.io/badge/Deploy-Online-success.svg)](https://poke-arena-back.onrender.com)
[![Frontend](https://img.shields.io/badge/Frontend-Live-success.svg)](https://poke-arena-app.onrender.com)
[![API Docs](https://img.shields.io/badge/API%20Docs-Swagger-brightgreen.svg)](https://poke-arena-back.onrender.com/api-docs)
[![Tests](https://img.shields.io/badge/Tests-57%20passing-success.svg)]()
[![Coverage](https://img.shields.io/badge/Coverage-100%25-success.svg)]()

## üöÄ Aplica√ß√£o Online

A aplica√ß√£o est√° dispon√≠vel online e pode ser acessada diretamente:

- **üé® Frontend (Aplica√ß√£o):** [https://poke-arena-app.onrender.com/](https://poke-arena-app.onrender.com/)
- **üìö API (Documenta√ß√£o Swagger):** [https://poke-arena-back.onrender.com/api-docs](https://poke-arena-back.onrender.com/api-docs)
- **üíö Health Check:** [https://poke-arena-back.onrender.com/health](https://poke-arena-back.onrender.com/health)

> ‚ö†Ô∏è **Nota:** A aplica√ß√£o est√° hospedada no plano gratuito do Render. O primeiro acesso pode levar ~30 segundos (cold start).

## üìã √çndice

- [Aplica√ß√£o Online](#-aplica√ß√£o-online)
- [Sobre](#sobre)
- [Frontend](#frontend)
- [Features](#features)
- [Tecnologias](#tecnologias)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [Uso](#uso)
- [API Documentation](#api-documentation)
- [Testes](#testes)
- [Docker](#docker)
- [Deploy](#deploy)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Contribuindo](#contribuindo)
- [Licen√ßa](#licen√ßa)

## üéØ Sobre

Pok√©Arena √© uma API completa para gerenciamento de pok√©mons com sistema de batalhas baseado em probabilidade. O projeto implementa opera√ß√µes CRUD completas, sistema de batalhas com algoritmo probabil√≠stico proporcional aos n√≠veis dos pok√©mons, e todas as melhores pr√°ticas de desenvolvimento moderno.

**üìä Desafio T√©cnico Jazida:**
- ‚úÖ 100% conforme com a especifica√ß√£o
- ‚úÖ 10 pontos (requisitos obrigat√≥rios)
- ‚úÖ +8 pontos (opcionais: testes, documenta√ß√£o, observabilidade)
- ‚úÖ 57 testes passando (32 unit√°rios + 25 E2E)
- ‚úÖ 100% code coverage

## üé® Frontend

A interface web do Pok√©Arena est√° dispon√≠vel em um reposit√≥rio separado:

- **Reposit√≥rio:** [poke-arena-front](https://github.com/YMdv/poke-arena-front)
- **Tecnologias:** React 18 + Vite + TypeScript + Chakra UI
- **Features:** Interface completa para CRUD de pok√©mons e sistema de batalhas

## ‚ú® Features

### CRUD de Pok√©mons

- ‚úÖ **Criar** pok√©mon (tipos: charizard, mewtwo, pikachu)
- ‚úÖ **Listar** todos os pok√©mons ativos
- ‚úÖ **Buscar** pok√©mon por ID
- ‚úÖ **Atualizar** treinador do pok√©mon
- ‚úÖ **Deletar** pok√©mon (soft delete)

### Sistema de Batalhas

- ‚úÖ Algoritmo probabil√≠stico baseado em n√≠veis
- ‚úÖ Vencedor ganha +1 n√≠vel
- ‚úÖ Perdedor perde -1 n√≠vel
- ‚úÖ Pok√©mon n√≠vel 0 = deletado permanentemente (hard delete)
- ‚úÖ Valida√ß√µes de batalha (mesmo pok√©mon, pok√©mons inexistentes)

**F√≥rmula de Probabilidade:**
```
P(A vencer) = nivelA / (nivelA + nivelB)
P(B vencer) = nivelB / (nivelA + nivelB)

Exemplo:
- A(n√≠vel=1) vs B(n√≠vel=2): 33.33% vs 66.67%
- A(n√≠vel=1) vs B(n√≠vel=1): 50% vs 50%
```

### Qualidade & DevOps

- ‚úÖ **TypeScript** com tipagem estrita
- ‚úÖ **Swagger/OpenAPI** para documenta√ß√£o autom√°tica
- ‚úÖ **Valida√ß√£o** autom√°tica de DTOs (class-validator)
- ‚úÖ **Health Checks** (database, memory)
- ‚úÖ **Logs estruturados** (Winston)
- ‚úÖ **Git Hooks** (Husky + lint-staged)
- ‚úÖ **CI/CD** (GitHub Actions)
- ‚úÖ **Docker** (desenvolvimento e produ√ß√£o)
- ‚úÖ **Soft Delete** com campo `active`
- ‚úÖ **BaseEntity** abstrata para DRY

## üõ†Ô∏è Tecnologias

### Core

| Tecnologia | Vers√£o | Descri√ß√£o |
|------------|--------|-----------|
| [Node.js](https://nodejs.org/) | 24.x | Runtime JavaScript |
| [TypeScript](https://www.typescriptlang.org/) | 5.7 | Superset JavaScript com tipagem |
| [NestJS](https://nestjs.com/) | 11.x | Framework backend progressivo |
| [PostgreSQL](https://www.postgresql.org/) | 16 | Banco de dados relacional |
| [TypeORM](https://typeorm.io/) | 0.3.x | ORM para TypeScript |

### Bibliotecas

- **Valida√ß√£o:** class-validator, class-transformer
- **Documenta√ß√£o:** @nestjs/swagger, swagger-ui-express
- **Config:** @nestjs/config, dotenv
- **Health:** @nestjs/terminus
- **Logs:** winston, nest-winston

### Qualidade & Testes

- **Testing:** Jest, Supertest, @nestjs/testing
- **Linting:** ESLint, Prettier
- **Git Hooks:** Husky, lint-staged

### DevOps

- **Containeriza√ß√£o:** Docker, Docker Compose
- **CI/CD:** GitHub Actions
- **Automa√ß√£o:** package.json scripts

## üì¶ Pr√©-requisitos

Escolha uma das op√ß√µes:

### Op√ß√£o 1: Docker (Recomendado)

- [Docker](https://www.docker.com/) >= 20.x
- [Docker Compose](https://docs.docker.com/compose/) >= 2.x

### Op√ß√£o 2: Local

- [Node.js](https://nodejs.org/) >= 24.x
- [Yarn](https://yarnpkg.com/) >= 1.22
- [PostgreSQL](https://www.postgresql.org/) >= 16

## üöÄ Instala√ß√£o

### Op√ß√£o 1: Docker - Apenas Banco de Dados (Recomendado)

Ideal para desenvolvimento local com hot-reload r√°pido:

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/YMdv/poke-arena-back.git
cd poke-arena-back

# 2. Instale as depend√™ncias
yarn install

# 3. Configure o ambiente
cp .env.example .env

# 4. Suba apenas o PostgreSQL
docker compose up -d

# 5. Inicie a API localmente
yarn start:dev
```

**Pronto!** A API estar√° rodando em http://localhost:3000

### Op√ß√£o 2: Docker Completo

Para rodar tudo containerizado (PostgreSQL + API):

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/YMdv/poke-arena-back.git
cd poke-arena-back

# 2. Copie o arquivo de ambiente
cp .env.docker .env

# 3. Inicie o ambiente de desenvolvimento
docker compose --profile dev up -d
```

**Pronto!** A API estar√° rodando em http://localhost:3000

### Op√ß√£o 3: Sem Docker

Requer PostgreSQL instalado localmente:

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/YMdv/poke-arena-back.git
cd poke-arena-back

# 2. Instale as depend√™ncias
yarn install

# 3. Configure o ambiente
cp .env.example .env
# Edite o .env com suas configura√ß√µes do PostgreSQL

# 4. Certifique-se que o PostgreSQL est√° rodando
# Crie o banco de dados:
createdb pokearena_db

# 5. Execute as migrations (se houver)
yarn migration:run

# 6. Inicie o servidor
yarn start:dev
```

**Pronto!** A API estar√° rodando em http://localhost:3000

## üíª Uso

### Scripts √öteis

```bash
# Desenvolvimento
yarn start:dev          # Inicia API em modo dev (hot-reload)
yarn db:up             # Sobe apenas PostgreSQL (Docker)
yarn db:down           # Para PostgreSQL

# Produ√ß√£o
yarn build             # Build da aplica√ß√£o
yarn start:prod        # Inicia API em modo produ√ß√£o

# Qualidade
yarn lint              # Roda ESLint
yarn format            # Formata c√≥digo com Prettier
yarn test              # Testes unit√°rios
yarn test:e2e          # Testes E2E
yarn test:cov          # Coverage

# Database
yarn migration:create  # Criar nova migration
yarn migration:run     # Executar migrations
yarn migration:revert  # Reverter √∫ltima migration
```

### URLs da Aplica√ß√£o

- **API Base:** http://localhost:3000
- **Swagger UI:** http://localhost:3000/api-docs
- **Health Check:** http://localhost:3000/health
- **Health Database:** http://localhost:3000/health/db
- **Health Memory:** http://localhost:3000/health/memory

## üìö API Documentation

### Swagger/OpenAPI

Acesse a documenta√ß√£o interativa completa em:

```
http://localhost:3000/api-docs
```

### Endpoints Principais

#### Pok√©mons

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| POST | `/pokemons` | Criar pok√©mon |
| GET | `/pokemons` | Listar todos |
| GET | `/pokemons/:id` | Buscar por ID |
| PUT | `/pokemons/:id` | Atualizar treinador |
| DELETE | `/pokemons/:id` | Deletar (soft delete) |

#### Batalhas

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| POST | `/batalhar/:pokemonAId/:pokemonBId` | Batalhar entre dois pok√©mons |

#### Health

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| GET | `/health` | Health check geral |
| GET | `/health/db` | Health check database |
| GET | `/health/memory` | Health check mem√≥ria |

### Exemplos de Uso

#### Criar Pok√©mon

```bash
curl -X POST http://localhost:3000/pokemons \
  -H "Content-Type: application/json" \
  -d '{
    "tipo": "pikachu",
    "treinador": "Ash"
  }'
```

**Resposta (201):**
```json
{
  "id": 1,
  "tipo": "pikachu",
  "treinador": "Ash",
  "nivel": 1
}
```

#### Listar Pok√©mons

```bash
curl http://localhost:3000/pokemons
```

**Resposta (200):**
```json
[
  {
    "id": 1,
    "tipo": "pikachu",
    "treinador": "Ash",
    "nivel": 1
  },
  {
    "id": 2,
    "tipo": "charizard",
    "treinador": "Red",
    "nivel": 5
  }
]
```

#### Batalhar

```bash
curl -X POST http://localhost:3000/batalhar/1/2
```

**Resposta (200):**
```json
{
  "vencedor": {
    "id": 2,
    "tipo": "charizard",
    "treinador": "Red",
    "nivel": 6
  },
  "perdedor": {
    "id": 1,
    "tipo": "pikachu",
    "treinador": "Ash",
    "nivel": 0
  }
}
```

## üß™ Testes

### Executar Testes

```bash
# Testes unit√°rios
yarn test

# Watch mode
yarn test:watch

# Com coverage
yarn test:cov

# Testes E2E
yarn test:e2e

# Todos os testes
yarn test:all
```

### Coverage

```bash
yarn test:cov
```

Target: **>80% de coverage**

### Estrutura de Testes

```
test/
‚îî‚îÄ‚îÄ e2e/                            # Testes E2E com Pactum
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îî‚îÄ‚îÄ jest-pactum.config.js
    ‚îú‚îÄ‚îÄ setup/
    ‚îÇ   ‚îú‚îÄ‚îÄ global-setup.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ global-teardown.ts
    ‚îú‚îÄ‚îÄ helpers/
    ‚îÇ   ‚îú‚îÄ‚îÄ pactum-config.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ assertions.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ stores.ts
    ‚îú‚îÄ‚îÄ fixtures/
    ‚îÇ   ‚îú‚îÄ‚îÄ pokemon.fixtures.ts
    ‚îÇ   ‚îî‚îÄ‚îÄ battle.fixtures.ts
    ‚îî‚îÄ‚îÄ specs/
        ‚îú‚îÄ‚îÄ pokemon.pactum.e2e-spec.ts   # Testes E2E de pok√©mons
        ‚îî‚îÄ‚îÄ battle.pactum.e2e-spec.ts    # Testes E2E de batalhas

src/
‚îú‚îÄ‚îÄ pokemon/
‚îÇ   ‚îî‚îÄ‚îÄ __tests__/
‚îÇ       ‚îú‚îÄ‚îÄ pokemon.service.spec.ts     # Unit tests
‚îÇ       ‚îî‚îÄ‚îÄ pokemon.controller.spec.ts  # Unit tests
‚îî‚îÄ‚îÄ battle/
    ‚îî‚îÄ‚îÄ __tests__/
        ‚îú‚îÄ‚îÄ battle.service.spec.ts      # Unit tests
        ‚îî‚îÄ‚îÄ battle.controller.spec.ts   # Unit tests
```

## üê≥ Docker

O projeto usa Docker Compose com **profiles** para diferentes ambientes:

### Profiles Dispon√≠veis

1. **Sem profile:** Apenas PostgreSQL (banco de dados isolado)
2. **`--profile dev`:** PostgreSQL + API em modo desenvolvimento (hot-reload)
3. **`--profile prod`:** PostgreSQL + API em modo produ√ß√£o (otimizado)
4. **`--profile tools`:** Adiciona PgAdmin (interface gr√°fica para PostgreSQL)

### Quick Start

```bash
# Apenas banco de dados (para desenvolvimento local da API)
docker compose up -d

# Desenvolvimento completo (PostgreSQL + API)
docker compose --profile dev up -d

# Produ√ß√£o
docker compose --profile prod up -d

# Desenvolvimento com PgAdmin
docker compose --profile dev --profile tools up -d

# Parar tudo
docker compose down
```

### Recomenda√ß√£o de Uso

**Desenvolvimento local (recomendado):**
```bash
# 1. Subir apenas PostgreSQL
docker compose up -d

# 2. Rodar API localmente (em outro terminal)
yarn start:dev
```

Essa abordagem oferece melhor performance e experi√™ncia de desenvolvimento.

### Comandos √öteis

```bash
# Ver containers rodando
docker compose ps

# Ver logs
docker compose logs -f

# Ver logs de um servi√ßo espec√≠fico
docker compose logs -f postgres
docker compose logs -f api-dev

# Acessar shell do container da API
docker compose exec api-dev sh

# Limpar tudo (containers e volumes)
docker compose down -v
```

### PgAdmin

Se iniciado com profile `tools`:

- **URL:** http://localhost:5050
- **Email:** admin@pokearena.com
- **Senha:** admin

**Configurar conex√£o:**
- Host: `postgres`
- Port: `5432`
- Database: `pokearena_db`
- Username: `postgres`
- Password: `postgres`

Para mais detalhes, veja [docker/README.md](./docker/README.md)

## üöÄ Deploy

### üåê Aplica√ß√£o em Produ√ß√£o

A aplica√ß√£o j√° est√° deployada e dispon√≠vel online:

- **Frontend:** [https://poke-arena-app.onrender.com/](https://poke-arena-app.onrender.com/)
- **Backend API:** [https://poke-arena-back.onrender.com](https://poke-arena-back.onrender.com)
- **Swagger Docs:** [https://poke-arena-back.onrender.com/api-docs](https://poke-arena-back.onrender.com/api-docs)

**Plataforma:** Render (plano gratuito)
**Banco de Dados:** PostgreSQL 16 (Render)
**CI/CD:** GitHub Actions com deploy autom√°tico

---

### Prepara√ß√£o para Novo Deploy

1. Configure as vari√°veis de ambiente de produ√ß√£o
2. Configure secrets no GitHub (se usar CD)
3. Escolha a plataforma de deploy

### Plataformas Suportadas

#### Railway

```bash
# 1. Instale CLI
npm i -g @railway/cli

# 2. Login
railway login

# 3. Deploy
railway up
```

#### Render

1. Conecte reposit√≥rio no [Render](https://render.com)
2. Configure servi√ßo Web
3. Adicione PostgreSQL database
4. Deploy autom√°tico

#### Docker Hub

```bash
# Build
docker build -t seu-usuario/pokearena:latest .

# Push
docker push seu-usuario/pokearena:latest
```

Para habilitar deploy autom√°tico via GitHub Actions, veja [.github/workflows/README.md](.github/workflows/README.md)

## üìÅ Estrutura do Projeto

```
poke-arena-back/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ common/              # C√≥digo compartilhado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/        # BaseEntity abstrata
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/         # Exception filters
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/    # Interceptors
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pipes/           # Validation pipes
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configura√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.config.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.config.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swagger.config.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pokemon/             # M√≥dulo Pokemon
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enums/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pokemon.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pokemon.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pokemon.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ battle/              # M√≥dulo Battle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ battle.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ battle.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ battle.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ health/              # Health checks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health.controller.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ health.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts        # M√≥dulo raiz
‚îÇ   ‚îî‚îÄ‚îÄ main.ts              # Bootstrap
‚îÇ
‚îú‚îÄ‚îÄ test/                    # Testes E2E
‚îú‚îÄ‚îÄ database/                # Migrations
‚îú‚îÄ‚îÄ .github/                 # CI/CD workflows
‚îú‚îÄ‚îÄ .husky/                  # Git hooks
‚îú‚îÄ‚îÄ docker/                  # Docker configs
‚îú‚îÄ‚îÄ Dockerfile               # Imagem produ√ß√£o
‚îú‚îÄ‚îÄ Dockerfile.dev           # Imagem desenvolvimento
‚îî‚îÄ‚îÄ docker-compose.yml       # Orquestra√ß√£o
```

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Siga os passos:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'feat: adiciona AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

### Conven√ß√£o de Commits

Seguimos [Conventional Commits](https://www.conventionalcommits.org/) (validado automaticamente):

**Formato obrigat√≥rio:**
```
<type>[optional scope]: <description>
```

**Tipos v√°lidos:**
- `feat` - Nova funcionalidade
- `fix` - Corre√ß√£o de bug
- `docs` - Documenta√ß√£o
- `style` - Formata√ß√£o de c√≥digo
- `refactor` - Refatora√ß√£o
- `perf` - Melhoria de performance
- `test` - Testes
- `build` - Build/depend√™ncias
- `ci` - CI/CD
- `chore` - Manuten√ß√£o
- `revert` - Reverter commit

**Exemplos:**
```bash
git commit -m "feat: add pokemon battle system"
git commit -m "fix(api): resolve endpoint error"
git commit -m "docs: update README"
```

### Workflow

1. **Pre-commit:** ESLint + Prettier nos arquivos staged
2. **Commit-msg:** Valida formato Conventional Commits
3. **Pre-push:** Build + Testes unit√°rios
4. **CI Pipeline:** Lint, Tests, E2E, Build (GitHub Actions)
5. **Code Review:** Pelo menos 1 aprova√ß√£o
6. **CD Pipeline:** Deploy autom√°tico ap√≥s merge

> üí° Os hooks do Husky garantem qualidade antes do c√≥digo chegar ao reposit√≥rio remoto. Veja [.husky/README.md](.husky/README.md) para mais detalhes.

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üë• Autor

- **Yuri Mancini** - Desenvolvimento

## üôè Agradecimentos

- [NestJS](https://nestjs.com/) - Framework backend progressivo
- [TypeORM](https://typeorm.io/) - ORM poderoso e flex√≠vel
- [PostgreSQL](https://www.postgresql.org/) - Banco de dados robusto e confi√°vel

---

<div align="center">

**[‚¨Ü Voltar ao topo](#-pok√©arena-api)**

Desenvolvido com ‚ù§Ô∏è usando TypeScript, NestJS e PostgreSQL

</div>